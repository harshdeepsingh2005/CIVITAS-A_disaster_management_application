{% extends "base.html" %}

{% block title %}Reports - Civitas{% endblock %}

{% block content %}
<div class="reports-page">
    <div class="page-header">
        <h1>üìã Incident Reports</h1>
        <p>Submit and manage disaster incident reports</p>
    </div>

    {% if current_user.role == 'citizen' %}
        <!-- Citizen Report Form -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üìù Submit New Report</h3>
                <span class="card-subtitle">Report incidents, damages, or emergencies</span>
            </div>
            <form class="civitas-form" data-action="reports">
                <div class="form-group">
                    <label for="title" class="form-label">Report Title</label>
                    <input type="text" id="title" name="title" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label for="description" class="form-label">Description</label>
                    <textarea id="description" name="description" class="form-textarea" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="location" class="form-label">Location</label>
                    <input type="text" id="location" name="location" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label for="severity" class="form-label">Severity Level</label>
                    <select id="severity" name="severity" class="form-select" required>
                        <option value="low">Low - Minor issue</option>
                        <option value="medium" selected>Medium - Moderate concern</option>
                        <option value="high">High - Serious situation</option>
                        <option value="critical">Critical - Emergency</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    <span class="loading-spinner" style="display: none;"></span>
                    <span class="btn-text">Submit Report</span>
                </button>
            </form>
        </div>
    {% endif %}

    <!-- Reports List -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">üìä All Reports</h3>
            <div class="card-actions">
                <button class="btn btn-secondary" onclick="refreshReports()">üîÑ Refresh</button>
            </div>
        </div>
        <div class="reports-list" id="reportsList">
            <div class="loading-placeholder">
                <div class="loading-spinner"></div>
                <span>Loading reports...</span>
            </div>
        </div>
    </div>
</div>

<style>
.page-header {
    text-align: center;
    margin-bottom: 2rem;
}

.page-header h1 {
    font-size: 2.5rem;
    color: var(--neon-blue);
    margin-bottom: 0.5rem;
}

.page-header p {
    color: var(--text-secondary);
    font-size: 1.1rem;
}

.card-actions {
    display: flex;
    gap: 1rem;
}

.reports-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.report-item {
    background: var(--accent-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1.5rem;
    transition: all 0.3s ease;
}

.report-item:hover {
    border-color: var(--neon-blue);
    box-shadow: 0 4px 16px rgba(0, 212, 255, 0.1);
}

.report-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.report-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.report-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    margin-bottom: 1rem;
}

.report-location {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.report-description {
    color: var(--text-primary);
    line-height: 1.6;
    margin-bottom: 1rem;
}

.ai-summary {
    background: rgba(0, 212, 255, 0.1);
    border-left: 3px solid var(--neon-blue);
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 0 8px 8px 0;
}

.ai-summary-title {
    font-weight: bold;
    color: var(--neon-blue);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.ai-summary-content {
    color: var(--text-primary);
    font-size: 0.9rem;
}

.report-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}

.loading-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    padding: 2rem;
    color: var(--text-secondary);
}

.empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--text-secondary);
}

.empty-state-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

@media (max-width: 768px) {
    .report-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .report-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .report-actions {
        justify-content: flex-start;
        flex-wrap: wrap;
    }
}
</style>

<script>
async function loadReports() {
    try {
        const response = await fetch('/api/reports');
        const reports = await response.json();
        
        const reportsList = document.getElementById('reportsList');
        
        if (reports.length === 0) {
            reportsList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <h3>No reports found</h3>
                    <p>No incident reports have been submitted yet.</p>
                </div>
            `;
            return;
        }
        
        reportsList.innerHTML = reports.map(report => `
            <div class="report-item">
                <div class="report-header">
                    <div>
                        <div class="report-title">${report.title}</div>
                        <div class="report-meta">
                            <span class="report-location">üìç ${report.location}</span>
                            <span class="status-badge status-${report.severity}">${report.severity}</span>
                            <span class="status-badge status-${report.status}">${report.status}</span>
                        </div>
                    </div>
                </div>
                
                <div class="report-description">${report.description}</div>
                
                ${report.ai_summary ? `
                    <div class="ai-summary">
                        <div class="ai-summary-title">
                            ü§ñ AI Summary
                        </div>
                        <div class="ai-summary-content">${report.ai_summary}</div>
                    </div>
                ` : ''}
                
                <div class="report-actions">
                    <span class="text-muted">Submitted ${new Date(report.created_at).toLocaleString()}</span>
                </div>
            </div>
        `).join('');
        
    } catch (error) {
        console.error('Error loading reports:', error);
        document.getElementById('reportsList').innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">‚ùå</div>
                <h3>Error loading reports</h3>
                <p>Please try again later.</p>
            </div>
        `;
    }
}

function refreshReports() {
    loadReports();
}

// Load reports when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadReports();
});
</script>
{% endblock %}

